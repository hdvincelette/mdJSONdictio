---
title: "Introduction to mdJSONdictio"
output: 
  # html_document:
  #   theme: readable
  #   highlight:
  #   fig_caption: true
  knitr:::html_vignette:
    toc: true
  pdf_document:
    highlight: null
    number_sections: yes
vignette: >
  %\VignetteIndexEntry{mdJSONdictio}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
<style type="text/css">
  body{
  font-size: 12pt;
}
</style>



```{css, echo=FALSE}
# .main-container {
#     max-width: 600px !important;
# }

pre {
  max-height: 300px !important;
  overflow-y: auto !important;
  overflow-x: scroll !important;
}
pre code {
  white-space: pre
}
```


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(width = 9999)

library(mdJSONdictio)
library(knitr)
library(bookdown)
library(kableExtra)
library(tibble)
library(rmarkdown)
library(DT)
library(png)
library(utils)
library(rjson)
```
<br />
Anyone who has written metadata in mdEditor knows creating dictionaries can be tedious and repetitive. The R package mdJSONdictio aims to streamline this process. Rather than defining data table attributes in [mdEditor](https://go.mdeditor.org/#/dashboard), users can fill out a tabular data dictionary template and translate it to mdJSON using the function ```build.mdJSON()```. The resultant mdJSON file can be imported in mdEditor to create a Dictionary record with data table attributes already defined. Conversely, the functon ```build.table()``` transforms mdEditor data dictionary files into a tabular format to be used as a human-readable reference. 
<br />
<br />
<br />


# Functions
## ```build.mdJSON()``` 

Transforms a tabular data dictionary into an R list that can be subsequently converted to mdJSON and imported to mdEditor as a Dictionary record. The input data frame must be formatted to a template as described in the [Tabular Data Dictionary Template] section. A required parameter is ```title```, which accepts a string to designate the title of the Dictionary record in mdEditor.
<br />
<br />

#### A tabular data dictionary imported as a data frame in R:

```{r, echo=FALSE}

# paged_table(readxl::read_excel(system.file("extdata", "e.g.dictionary.xlsx", package = #"mdJSONdictio")), options=list(cols.print=4))

print(readxl::read_excel(system.file("extdata", "e.g.dictionary.xlsx", package = "mdJSONdictio")), n = 1e3)

```
<br />

#### The function return value in R:

```{r, echo=FALSE}
print(rjson::fromJSON(file= system.file("extdata", "e.g.dictionary.json", package = "mdJSONdictio")))
```
<br />


## ```build.table()``` 

Transforms an mdEditor mdJSON data dictionary (imported as an R list) into a data frame to be used as a human-readable reference. The output is formatted to the template described in the [Tabular Data Dictionary Template] section. Optional parameters are ```entity_num``` and ```dictionary_num```, which accept integers to indicate the dictionary and entity to be processed if more than one exists in the mdJSON file. This is useful when multiple entities are created in the Entity tab of a Dictionary record or multiple dictionaries are exported together in mdEditor. By default, ```entity_num = 1``` and ```dictionary_num = 1```, so if the mdJSON file only has one entity and dictionary, these parameters can be ignored.

<em>Note: Depending on how the Dictionary record was completed in mdEditor, an mdJSON file processed by this function may output a table with additional columns other than those in the tabular data dictionary template. Refer to the [mdJSON Data Dictionary](https://mdbook.adiwg.org/appendix/mdjson_data_dictionary.html) to translate these and other mdEditor terms</em>.


<br />
<br />

#### An mdJSON data dictionary imported as a list in R:

```{r, echo=FALSE}
print(rjson::fromJSON(file= system.file("extdata", "e.g.dictionary2.json", package = "mdJSONdictio")))
```
<br />

#### The function return value in R:

```{r, echo=FALSE}

print(as_tibble(read.csv(system.file("extdata", "e.g.dictionary2.csv", package = "mdJSONdictio"))), n = 1e3)

```
<br />


## Intented Use 

```mdJSONdictio``` functions are intended for anyone who writes mdEditor metadata. ```build.mdJSON()``` helps ease the process of creating mdEditor Dictionary records by allowing users to complete some fields in a simplified tabular format. ```build.table()``` creates a human-readable data dictionary reference for an mdEditor Dictionary record. A potential workflow is to use  ```build.mdJSON()``` to initiate a Dictionary record, the mdEditor web application to maintain the Dictionary record, and ```build.table()``` to create an up-to-date human-readable data dictionary as needed.
<br />
<br />

## Quick Guide to [mdEditor](https://go.mdeditor.org/#/dashboard)

### After building your mdJSON data dictionary:

#### 1. Import the mdJSON data dictionary to mdEditor
Open mdEditor in your browser and navigate to the Import tab at the top of the page. Drag and drop the newly written mdJSON file and click "Import Data." This will generate a Dictionary record with the dictionary title you specified in the function. You may need to refresh your browser if the dictionary does not immediately appear

#### 2. Fix errors in the Dictionary record
When viewing your Dictionary record, you will notice an orange exclamation mark next to the title that indicates the dictionary is incomplete and has missing or erroneous elements. Click the orange exclamation mark to view the details. These errors can be remedied by completing the Responsible Party field in the Main tab and the Entity Code Name and Definition fields in the Entities tab. For more information about these fields, refer to the [mdEditor User Manual](https://guide.mdeditor.org/reference/reference-manual.html). You will know your dictionary is free of errors when the orange triangle disappears and the edit icon next to your Dictionary record in the left-hand menu is green. If you see more than these three errors, make sure the tabular data dictionary is filled out as described in the [Tabular Data Dictionary Template] section.

#### 3. Associate and maintain the Dictionary record
Once the Dictionary record is free of errors, it can be associated with the Metadata record(s) it describes (e.g. tabular dataset, shapefiles) to help create archival quality project metadata. For details of this process and other information, refer to the [mdEditor User Manual](https://guide.mdeditor.org/). Any future updates to your Dictionary record can be done manually in the mdEditor web application. 
<br />
<br />

### Before building your tabular data dictionary:

#### 1. Complete required mdEditor fields
Open mdEditor in your browser and import your mdJSON data dictionary file as described in step 1 above. Navigate to your Dictionary record and verify the contents and check for errors. You will know your dictionary is free of errors when the orange triangle disappears and the edit icon next to your Dictionary record in the left-hand menu is green. While ```build.table()``` only requires an entity with at least one defined attribute, an error-free Dictionary record is more likely to be exported with a structure that can be processed by the function. Please note, if your Dictionary record contains two entities, they will be processed into a single tabular data dictionary.

#### 2. Export the mdJSON data dictionary
Navigate to the Export tab at the top of the page. Make sure no Metadata records, Contacts or undesired Dictionaries are selected (select and deselect the checkboxes under the search bars). Select the desired dictionary and click "Export Selected" to the right of the screen. Save the file to your working space. If you are not prompted to select a save location, the file may have automatically saved to your local Downloads folder. If you intend to transform more than one Dictionary record into a table, you can select and export them together into a single mdJSON file and specify which dictionary is processed by ```build.table()``` with the parameter ```dictionary_num```.
<br />
<br />
<br />

# Tabular Data Dictionary Template

```build.mdJSON()``` only reads data frames formatted to a data dictionary template (Figure 1.1), which can be downloaded [here](https://github.com/hdvincelette/mdJSONdictio/blob/master/inst/templates/mdJSONdictio_Dictionary_Template_v1.xlsx?raw=true). While csv is a more flexible file format, this template is in xlsx format because it contains validation rules that prevent incorrect values from being entered, resulting in errors when using ```build.mdJSON()``` or creating the Dictionary record in mdEditor.
<br />
<br />

#### Figure 1.1: Data dictionary template in Excel.
![](https://github.com/hdvincelette/mdJSONdictio/raw/master/man/figures/dictionary_template.png)
```{r, echo=FALSE}
# knitr::include_graphics(system.file("help/figures","dictionary_template.png", package = "mdJSONdictio"))
```
<br />
<br />
The two main components of the tabular data dictionary template are attributes and entry values, each of which are represented as a row. Entry values are known as "domain items" which collectively make up the "domain" of an attribute. It is important to remember that while entry values are associated with a certain attribute, not all attributes have defined entry values. For example, the attribute "Sex" may have three defined entry values ("F","M", and "U"), where as the attribute "Year" does not have defined entry values since an unlimited number of years can be entered.
<br />
<br />
Table 1.1 describes the header in the tabular data dictionary template, which represent field(s) in mdEditor Dictionary records. "Definition" describes the template column. Many of these definitions are derived from the [mdEditor User Manual](https://guide.mdeditor.org/reference/edit-window/dictionary/dictionary-record.html). "DataType" indicates the type of value allowed in the template column. "Required" indicates whether the template column is required by attributes and/or entry values ("No" indicates it is not required by either attributes or entry values). 
<br />
<br />
 
Note:

- The template columns "codeName," "domainItem_name," "domainItem_value," and "definition" are all required by attributes and entry values.
- The template columns "dataType" and "allowNull" are required by attributes
<br />
<br />

<em>Tip: View attribute rows by filtering the dictionary column "domainItem_name" to "colname" and verify all rows have values for dictionary columns "dataType" and "allowNull".</em>
<br />
<br />

#### Table 1.1: Column descriptions for the data dictionary template.

<font size="2.5"> 
```{r, echo=FALSE}
kable(read.csv(path<-system.file("extdata", "template_column_definitions.csv", package = "mdJSONdictio")),align = "l") %>%
  kable_styling(full_width = F)
```
</font>
<br />
<br />
The "dataType" dictionary column has numerous defined entry values as shown in Table 1.2. These are derived from the mdEditor web application. The definitions in Table 1.2 were acquired from the [mdCodes Viewer](https://adiwg.github.io/mdTools/#codes-page) in the mdTools interface.
<br />
<br />

#### Table 1.2: dataType entry value descriptions for the data dictionary template.

<font size="2.5"> 
```{r, echo=FALSE}
kable(read.csv(path<-system.file("extdata", "datatype_definitions.csv", package = "mdJSONdictio")), align = "l") %>%
  kable_styling(full_width = F,position = "left")
```
</font>
<br />
<br />
<br />


# Helpful resources

[Hands-On Programming with R](https://rstudio-education.github.io/hopr/index.html)

[mdEditor User Manual](https://guide.mdeditor.org/)

[ADIwg Metadata Toolkit](https://mdbook.adiwg.org/)

[mdCodes Viewer](https://adiwg.github.io/mdTools/)


